{% extends "dashboard_base.html" %}

{% block page_title %}Profile Management{% endblock %}

{% block content %}
<div class="container">
    <div class="form-card">
        <h2>My Profile</h2>
        <p class="text-muted">Update your profile information</p>
        
        <form id="profileForm">
            <div class="form-group">
                <label for="first_name">First Name *</label>
                <input type="text" id="first_name" name="first_name" value="{{ user_data.first_name or '' }}" required>
            </div>
            <div class="form-group">
                <label for="last_name">Last Name *</label>
                <input type="text" id="last_name" name="last_name" value="{{ user_data.last_name or '' }}" required>
            </div>
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" name="email" value="{{ user_data.email or '' }}" disabled>
                <small class="form-text">Email cannot be changed</small>
            </div>
            <div class="form-group">
                <label for="contact_number">Contact Number</label>
                <input type="tel" id="contact_number" name="contact_number" value="{{ user_data.contact_number or '' }}" placeholder="Enter your phone number">
            </div>
            <div class="form-group">
                <label for="year_level">Year Level</label>
                <input type="text" id="year_level" name="year_level" value="{{ user_data.year_level or '' }}" placeholder="e.g., Grade 10, Senior">
            </div>
            <button type="submit" class="btn btn-primary">Update Profile</button>
            <a href="{{ url_for('student.dashboard') }}" class="btn btn-secondary">Cancel</a>
        </form>
    </div>
</div>

<script>
document.getElementById('profileForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const formData = {
        first_name: document.getElementById('first_name').value,
        last_name: document.getElementById('last_name').value,
        contact_number: document.getElementById('contact_number').value,
        year_level: document.getElementById('year_level').value
    };
    
    try {
        const response = await fetch('/student/profile', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(formData)
        });
        
        const data = await response.json();
        if (data.success) {
            if (typeof Toastify === 'function') {
                Toastify({
                    text: 'Profile updated successfully!',
                    duration: 3000,
                    gravity: "top",
                    position: "right",
                    backgroundColor: "#34C38F",
                }).showToast();
            } else {
                alert('Profile updated successfully!');
            }
        } else {
            const errorMsg = data.error || 'Failed to update profile';
            if (typeof Toastify === 'function') {
                Toastify({
                    text: errorMsg,
                    duration: 5000,
                    gravity: "top",
                    position: "right",
                    backgroundColor: "#F44336",
                    close: true
                }).showToast();
            } else {
                alert(errorMsg);
            }
        }
    } catch (error) {
        if (typeof Toastify === 'function') {
            Toastify({
                text: 'An error occurred. Please try again.',
                duration: 5000,
                gravity: "top",
                position: "right",
                backgroundColor: "#F44336",
            }).showToast();
        } else {
            alert('An error occurred. Please try again.');
        }
    }
});
</script>

<style>
.text-muted {
    color: #6B7280;
    margin-bottom: 1.5rem;
}

.form-text {
    display: block;
    margin-top: 0.25rem;
    font-size: 0.875rem;
    color: #6B7280;
}
</style>
{% endblock %}

